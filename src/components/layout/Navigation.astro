---
import { siteConfig } from "../../data/site-config";
import ArrowIcon from "../ui/icons/ArrowIcon.astro";
import PlayIcon from "../ui/icons/PlayIcon.astro";

const { navLinks } = siteConfig;
---

<nav id="nav" class="fixed top-0 left-0 right-0 h-18 z-50 transition-all duration-500">
  <div class="absolute inset-0 bg-dark/60 backdrop-blur-2xl border-b border-white/[0.04] opacity-0 transition-opacity duration-500" id="nav-bg"></div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-full relative">
    <!-- Logo -->
    <a href="#hero" class="flex items-center gap-3 group">
      <div class="w-10 h-10 rounded-xl gradient-bg flex items-center justify-center transition-transform duration-300 group-hover:scale-105 glow-primary">
        <PlayIcon size={18} stroke class="text-white" />
      </div>
      <span class="text-xl font-display font-semibold tracking-tight">
        <span class="text-white">Motion</span><span class="gradient-text-static">Glyph</span>
      </span>
    </a>

    <!-- Desktop Navigation -->
    <ul class="hidden md:flex items-center gap-1">
      {navLinks.map((link) => (
        <li>
          <a href={link.href} class="nav-link relative px-4 py-2.5 text-sm text-gray-400 hover:text-white transition-all duration-300 rounded-lg group">
            {link.label}
            <span class="absolute bottom-1 left-4 right-4 h-0.5 bg-gradient-to-r from-primary to-accent scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left rounded-full"></span>
          </a>
        </li>
      ))}
    </ul>

    <!-- CTA Button -->
    <a href="#contact" class="hidden md:inline-flex items-center gap-2 gradient-bg text-white px-5 py-2.5 rounded-xl text-sm font-medium transition-all duration-300 hover:shadow-lg hover:shadow-primary/25 hover:scale-[1.02] btn-magnetic">
      Get Started
      <ArrowIcon size={14} />
    </a>

    <!-- Mobile Menu Button -->
    <button id="nav-toggle" class="md:hidden flex flex-col justify-center gap-1.5 w-10 h-10 rounded-lg" aria-label="Toggle menu" aria-expanded="false">
      <span class="block w-5 h-0.5 bg-white transition-all mx-auto origin-center"></span>
      <span class="block w-5 h-0.5 bg-white transition-all mx-auto origin-center"></span>
      <span class="block w-5 h-0.5 bg-white transition-all mx-auto origin-center"></span>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="fixed inset-0 flex flex-col items-center justify-center gap-8 transform translate-x-full transition-all duration-500 md:hidden z-40 overflow-hidden">
    <!-- Background -->
    <div class="absolute inset-0 bg-dark/98 backdrop-blur-2xl"></div>

    <!-- Ambient glow -->
    <div class="absolute top-1/4 left-1/2 -translate-x-1/2 w-96 h-96 bg-primary/10 rounded-full blur-3xl"></div>

    <!-- Menu items -->
    <div class="relative z-10 flex flex-col items-center gap-6">
      {navLinks.map((link, i) => (
        <a href={link.href} class="text-3xl font-display font-semibold text-gray-300 hover:text-white hover:gradient-text transition-all duration-300" style={`transition-delay: ${i * 50}ms`}>
          {link.label}
        </a>
      ))}
    </div>

    <a href="#contact" class="relative z-10 mt-4 gradient-bg text-white px-8 py-4 rounded-xl font-medium text-lg glow-primary">
      Get Started
    </a>
  </div>
</nav>

<style>
  .nav-link.active {
    color: white;
  }

  .nav-link.active span {
    transform: scaleX(1);
  }

  nav {
    height: 72px;
  }

  nav.scrolled #nav-bg {
    opacity: 1;
  }
</style>

<script>
  const nav = document.getElementById("nav");
  const navBg = document.getElementById("nav-bg");
  const navToggle = document.getElementById("nav-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const toggleSpans = navToggle?.querySelectorAll("span");
  const navLinks = document.querySelectorAll(".nav-link");

  // Scroll effect
  const handleScroll = () => {
    if (window.scrollY > 50) {
      nav?.classList.add("scrolled");
    } else {
      nav?.classList.remove("scrolled");
    }
  };

  window.addEventListener("scroll", handleScroll, { passive: true });
  handleScroll();

  // Active section highlighting
  const sections = document.querySelectorAll("section[id]");
  const highlightNav = () => {
    const scrollY = window.scrollY + 100;

    sections.forEach((section) => {
      const sectionTop = (section as HTMLElement).offsetTop;
      const sectionHeight = section.clientHeight;
      const sectionId = section.getAttribute("id");

      if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
        navLinks.forEach((link) => {
          link.classList.remove("active", "text-white");
          link.classList.add("text-gray-400");
          if (link.getAttribute("href") === `#${sectionId}`) {
            link.classList.add("active", "text-white");
            link.classList.remove("text-gray-400");
          }
        });
      }
    });
  };

  window.addEventListener("scroll", highlightNav, { passive: true });
  highlightNav();

  // Mobile menu toggle
  navToggle?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("translate-x-full");
    mobileMenu?.classList.toggle("translate-x-0");

    if (toggleSpans) {
      if (!mobileMenu?.classList.contains("translate-x-full")) {
        toggleSpans[0].classList.add("rotate-45", "translate-y-2");
        toggleSpans[1].classList.add("opacity-0", "scale-0");
        toggleSpans[2].classList.add("-rotate-45", "-translate-y-2");
        document.body.style.overflow = "hidden";
      } else {
        toggleSpans[0].classList.remove("rotate-45", "translate-y-2");
        toggleSpans[1].classList.remove("opacity-0", "scale-0");
        toggleSpans[2].classList.remove("-rotate-45", "-translate-y-2");
        document.body.style.overflow = "";
      }
    }
  });

  // Close mobile menu on link click
  mobileMenu?.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu.classList.add("translate-x-full");
      mobileMenu.classList.remove("translate-x-0");
      if (toggleSpans) {
        toggleSpans[0].classList.remove("rotate-45", "translate-y-2");
        toggleSpans[1].classList.remove("opacity-0", "scale-0");
        toggleSpans[2].classList.remove("-rotate-45", "-translate-y-2");
      }
      document.body.style.overflow = "";
    });
  });
</script>
