---
import { siteConfig } from "../../data/site-config";
import ArrowIcon from "../ui/icons/ArrowIcon.astro";
import PlayIcon from "../ui/icons/PlayIcon.astro";

const { navLinks } = siteConfig;
---

<nav id="nav" class="fixed top-0 left-0 right-0 h-16 z-50 transition-all duration-300 bg-dark/80 backdrop-blur-lg border-b border-white/[0.06]">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-full">
    <!-- Logo -->
    <a href="#hero" class="flex items-center gap-2">
      <div class="w-8 h-8 rounded-lg gradient-bg flex items-center justify-center">
        <PlayIcon size={16} stroke class="text-white" />
      </div>
      <span class="text-lg font-semibold">
        <span class="text-white">Motion</span><span class="text-primary">Glyph</span>
      </span>
    </a>

    <!-- Desktop Navigation -->
    <ul class="hidden md:flex items-center gap-1">
      {navLinks.map((link) => (
        <li>
          <a href={link.href} class="nav-link px-4 py-2 text-sm text-gray-400 hover:text-white transition-colors rounded-lg">
            {link.label}
          </a>
        </li>
      ))}
    </ul>

    <!-- CTA Button -->
    <a href="#contact" class="hidden md:inline-flex items-center gap-2 gradient-bg text-white px-4 py-2 rounded-lg text-sm font-medium hover:opacity-90 transition-opacity">
      Get Started
      <ArrowIcon size={14} />
    </a>

    <!-- Mobile Menu Button -->
    <button id="nav-toggle" class="md:hidden flex flex-col justify-center gap-1.5 w-10 h-10 rounded-lg" aria-label="Toggle menu" aria-expanded="false">
      <span class="block w-5 h-0.5 bg-white transition-all mx-auto"></span>
      <span class="block w-5 h-0.5 bg-white transition-all mx-auto"></span>
      <span class="block w-5 h-0.5 bg-white transition-all mx-auto"></span>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="fixed inset-0 bg-dark/95 backdrop-blur-xl flex flex-col items-center justify-center gap-6 transform translate-x-full transition-transform duration-300 md:hidden z-40">
    {navLinks.map((link) => (
      <a href={link.href} class="text-2xl font-semibold text-gray-400 hover:text-white transition-colors">
        {link.label}
      </a>
    ))}
    <a href="#contact" class="mt-4 gradient-bg text-white px-6 py-3 rounded-lg font-medium">
      Get Started
    </a>
  </div>
</nav>

<style>
  .nav-link.active {
    color: white;
  }
</style>

<script>
  const nav = document.getElementById("nav");
  const navToggle = document.getElementById("nav-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const toggleSpans = navToggle?.querySelectorAll("span");
  const navLinks = document.querySelectorAll(".nav-link");

  // Active section highlighting
  const sections = document.querySelectorAll("section[id]");
  const highlightNav = () => {
    const scrollY = window.scrollY + 100;

    sections.forEach((section) => {
      const sectionTop = (section as HTMLElement).offsetTop;
      const sectionHeight = section.clientHeight;
      const sectionId = section.getAttribute("id");

      if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
        navLinks.forEach((link) => {
          link.classList.remove("active", "text-white");
          link.classList.add("text-gray-400");
          if (link.getAttribute("href") === `#${sectionId}`) {
            link.classList.add("active", "text-white");
            link.classList.remove("text-gray-400");
          }
        });
      }
    });
  };

  window.addEventListener("scroll", highlightNav, { passive: true });
  highlightNav();

  // Mobile menu toggle
  navToggle?.addEventListener("click", () => {
    mobileMenu?.classList.toggle("translate-x-full");
    mobileMenu?.classList.toggle("translate-x-0");

    if (toggleSpans) {
      if (!mobileMenu?.classList.contains("translate-x-full")) {
        toggleSpans[0].classList.add("rotate-45", "translate-y-2");
        toggleSpans[1].classList.add("opacity-0");
        toggleSpans[2].classList.add("-rotate-45", "-translate-y-2");
        document.body.style.overflow = "hidden";
      } else {
        toggleSpans[0].classList.remove("rotate-45", "translate-y-2");
        toggleSpans[1].classList.remove("opacity-0");
        toggleSpans[2].classList.remove("-rotate-45", "-translate-y-2");
        document.body.style.overflow = "";
      }
    }
  });

  // Close mobile menu on link click
  mobileMenu?.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu.classList.add("translate-x-full");
      mobileMenu.classList.remove("translate-x-0");
      if (toggleSpans) {
        toggleSpans[0].classList.remove("rotate-45", "translate-y-2");
        toggleSpans[1].classList.remove("opacity-0");
        toggleSpans[2].classList.remove("-rotate-45", "-translate-y-2");
      }
      document.body.style.overflow = "";
    });
  });
</script>
