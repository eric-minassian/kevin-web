---
import { siteConfig } from "../../data/site-config";
import ArrowIcon from "../ui/icons/ArrowIcon.astro";
import PlayIcon from "../ui/icons/PlayIcon.astro";

const { navLinks } = siteConfig;
---

<nav
  id="nav"
  class="fixed top-0 left-0 right-0 h-20 z-50 transition-all duration-500 bg-dark/30 backdrop-blur-xl border-b border-transparent"
>
  <!-- Subtle top highlight -->
  <div class="absolute top-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-white/5 to-transparent"></div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-full relative z-10">
    <!-- Logo -->
    <a href="#hero" class="group relative z-10 flex items-center gap-2">
      <!-- Logo icon -->
      <div class="w-10 h-10 rounded-xl gradient-bg-animated flex items-center justify-center shadow-lg shadow-primary/20 group-hover:shadow-primary/40 transition-shadow duration-300">
        <PlayIcon size={20} stroke class="text-white" />
      </div>
      <span class="text-xl font-bold tracking-tight">
        <span class="text-white">Motion</span><span class="gradient-text">Glyph</span>
      </span>
    </a>

    <!-- Desktop Navigation -->
    <ul id="nav-links" class="hidden md:flex items-center gap-1">
      {navLinks.map((link) => (
        <li>
          <a
            href={link.href}
            class="nav-link relative px-4 py-2 text-sm font-medium text-gray-400 hover:text-white transition-colors duration-300 rounded-lg"
            data-magnetic
          >
            <span class="relative z-10">{link.label}</span>
            <!-- Hover background -->
            <span class="absolute inset-0 bg-white/[0.05] rounded-lg scale-0 opacity-0 transition-all duration-300 nav-link-bg"></span>
            <!-- Active indicator -->
            <span class="absolute bottom-0 left-1/2 -translate-x-1/2 w-1 h-1 rounded-full bg-primary scale-0 transition-transform duration-300 nav-link-dot"></span>
          </a>
        </li>
      ))}
    </ul>

    <!-- CTA Button -->
    <a
      href="#contact"
      class="hidden md:inline-flex items-center gap-2 gradient-bg-animated text-white px-6 py-2.5 rounded-full font-semibold text-sm transition-all duration-300 hover:-translate-y-0.5 hover:shadow-lg hover:shadow-primary/40 overflow-hidden group"
    >
      <span class="relative z-10">Get Started</span>
      <ArrowIcon size={16} class="relative z-10 group-hover:translate-x-0.5 transition-transform" />
      <!-- Shimmer -->
      <span class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"></span>
    </a>

    <!-- Mobile Menu Button -->
    <button
      id="nav-toggle"
      class="md:hidden flex flex-col justify-center gap-1.5 w-10 h-10 z-10 rounded-lg bg-white/5 hover:bg-white/10 transition-colors"
      aria-label="Toggle menu"
      aria-expanded="false"
    >
      <span class="block w-5 h-0.5 bg-white transition-all duration-300 origin-center mx-auto"></span>
      <span class="block w-5 h-0.5 bg-white transition-all duration-300 mx-auto"></span>
      <span class="block w-5 h-0.5 bg-white transition-all duration-300 origin-center mx-auto"></span>
    </button>
  </div>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="fixed inset-0 bg-dark/95 backdrop-blur-2xl flex flex-col items-center justify-center gap-8 transform translate-x-full transition-transform duration-500 ease-[cubic-bezier(0.16,1,0.3,1)] md:hidden z-40"
  >
    <!-- Decorative elements -->
    <div class="absolute top-1/4 left-1/4 w-64 h-64 bg-primary/10 rounded-full blur-3xl"></div>
    <div class="absolute bottom-1/4 right-1/4 w-48 h-48 bg-accent/10 rounded-full blur-3xl"></div>

    {navLinks.map((link, index) => (
      <a
        href={link.href}
        class="text-3xl font-bold text-gray-400 hover:text-white hover:gradient-text transition-all duration-300 mobile-link"
        style={`transition-delay: ${index * 50}ms;`}
      >
        {link.label}
      </a>
    ))}

    <a
      href="#contact"
      class="mt-4 gradient-bg text-white px-8 py-4 rounded-full font-semibold text-lg mobile-link"
      style="transition-delay: 250ms;"
    >
      Get Started
    </a>
  </div>
</nav>

<style>
  .nav-link:hover .nav-link-bg {
    transform: scale(1);
    opacity: 1;
  }

  .nav-link:hover .nav-link-dot {
    transform: scale(1);
  }

  .nav-link.active {
    color: white;
  }

  .nav-link.active .nav-link-dot {
    transform: scale(1);
  }
</style>

<script>
  const nav = document.getElementById("nav");
  const navToggle = document.getElementById("nav-toggle");
  const mobileMenu = document.getElementById("mobile-menu");
  const toggleSpans = navToggle?.querySelectorAll("span");
  const navLinks = document.querySelectorAll(".nav-link");

  // Scroll effect with enhanced styling
  const handleScroll = () => {
    if (window.scrollY > 50) {
      nav?.classList.add("bg-dark/80", "border-white/[0.06]", "shadow-lg", "shadow-black/20");
      nav?.classList.remove("bg-dark/30", "border-transparent");
    } else {
      nav?.classList.remove("bg-dark/80", "border-white/[0.06]", "shadow-lg", "shadow-black/20");
      nav?.classList.add("bg-dark/30", "border-transparent");
    }
  };

  window.addEventListener("scroll", handleScroll, { passive: true });
  handleScroll();

  // Active section highlighting
  const sections = document.querySelectorAll("section[id]");
  const highlightNav = () => {
    const scrollY = window.scrollY + 100;

    sections.forEach((section) => {
      const sectionTop = (section as HTMLElement).offsetTop;
      const sectionHeight = section.clientHeight;
      const sectionId = section.getAttribute("id");

      if (scrollY >= sectionTop && scrollY < sectionTop + sectionHeight) {
        navLinks.forEach((link) => {
          link.classList.remove("active", "text-white");
          link.classList.add("text-gray-400");
          if (link.getAttribute("href") === `#${sectionId}`) {
            link.classList.add("active", "text-white");
            link.classList.remove("text-gray-400");
          }
        });
      }
    });
  };

  window.addEventListener("scroll", highlightNav, { passive: true });
  highlightNav();

  // Magnetic hover effect
  const magneticElements = document.querySelectorAll("[data-magnetic]");
  magneticElements.forEach((el) => {
    el.addEventListener("mousemove", (e: MouseEvent) => {
      const rect = (el as HTMLElement).getBoundingClientRect();
      const x = e.clientX - rect.left - rect.width / 2;
      const y = e.clientY - rect.top - rect.height / 2;
      (el as HTMLElement).style.transform = `translate(${x * 0.2}px, ${y * 0.2}px)`;
    });

    el.addEventListener("mouseleave", () => {
      (el as HTMLElement).style.transform = "translate(0, 0)";
    });
  });

  // Mobile menu toggle
  navToggle?.addEventListener("click", () => {
    const isOpen = mobileMenu?.classList.toggle("translate-x-full");
    mobileMenu?.classList.toggle("translate-x-0");

    if (toggleSpans) {
      if (!mobileMenu?.classList.contains("translate-x-full")) {
        toggleSpans[0].classList.add("rotate-45", "translate-y-2");
        toggleSpans[1].classList.add("opacity-0", "scale-0");
        toggleSpans[2].classList.add("-rotate-45", "-translate-y-2");
        document.body.style.overflow = "hidden";
      } else {
        toggleSpans[0].classList.remove("rotate-45", "translate-y-2");
        toggleSpans[1].classList.remove("opacity-0", "scale-0");
        toggleSpans[2].classList.remove("-rotate-45", "-translate-y-2");
        document.body.style.overflow = "";
      }
    }

    navToggle.setAttribute(
      "aria-expanded",
      String(!mobileMenu?.classList.contains("translate-x-full"))
    );
  });

  // Close mobile menu on link click
  mobileMenu?.querySelectorAll("a").forEach((link) => {
    link.addEventListener("click", () => {
      mobileMenu.classList.add("translate-x-full");
      mobileMenu.classList.remove("translate-x-0");
      if (toggleSpans) {
        toggleSpans[0].classList.remove("rotate-45", "translate-y-2");
        toggleSpans[1].classList.remove("opacity-0", "scale-0");
        toggleSpans[2].classList.remove("-rotate-45", "-translate-y-2");
      }
      document.body.style.overflow = "";
      navToggle?.setAttribute("aria-expanded", "false");
    });
  });
</script>
